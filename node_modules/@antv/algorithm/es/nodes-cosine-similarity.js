import { clone } from '@antv/util';
import { getPropertyWeight } from './utils/node-properties';
import cosineSimilarity from './cosine-similarity';
/**
 *  nodes-cosine-similarity算法 基于节点属性计算余弦相似度(基于种子节点寻找相似节点)
 * @param nodes 图节点数据
 * @param seedNode 种子节点
 */

var nodesCosineSimilarity = function nodesCosineSimilarity(nodes, seedNode) {
  if (nodes === void 0) {
    nodes = [];
  }

  var similarNodes = clone(nodes.filter(function (node) {
    return node.id !== seedNode.id;
  }));
  var seedNodeIndex = nodes.findIndex(function (node) {
    return node.id === seedNode.id;
  }); // 所有节点属性特征向量集合

  var allPropertiesWeight = getPropertyWeight(nodes); // 种子节点属性

  var seedNodeProperties = allPropertiesWeight[seedNodeIndex];
  var allCosineSimilarity = [];
  similarNodes.forEach(function (node, index) {
    if (node.id !== seedNode.id) {
      // 节点属性
      var nodeProperties = allPropertiesWeight[index]; // 计算节点向量和种子节点向量的余弦相似度

      var cosineSimilarityValue = cosineSimilarity(nodeProperties, seedNodeProperties);
      allCosineSimilarity.push(cosineSimilarityValue);
      node.cosineSimilarity = cosineSimilarityValue;
    }
  }); // 将返回的节点按照余弦相似度大小排序

  similarNodes.sort(function (a, b) {
    return b.cosineSimilarity - a.cosineSimilarity;
  });
  return {
    allCosineSimilarity: allCosineSimilarity,
    similarNodes: similarNodes
  };
};

export default nodesCosineSimilarity;